<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Vue-xlsx excel文件导出折腾小记 | 郝峰的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="# 前沿 最近再写vue-element-ui-pc项目中需要把数据导出为excel的需求，于是乎就开始折腾呗，没办法，谁让之前没有写过vue的导出数据呢，不折腾的攻城狮跟病猫有什么区别，不多说了，上思路与代码。  好在折腾了两天发现了js-xlsx这个东东，一个功能很强大excel处理库，只是下载各种格式excel，还支持读取excel，于是我就借鉴官网的例子搞了一下，其实原理我也不太懂，只是在">
<meta name="keywords" content="vue">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue-xlsx excel文件导出折腾小记">
<meta property="og:url" content="https://www.haofengvip.top/2017/12/11/vueXlsx/index.html">
<meta property="og:site_name" content="郝峰的博客">
<meta property="og:description" content="# 前沿 最近再写vue-element-ui-pc项目中需要把数据导出为excel的需求，于是乎就开始折腾呗，没办法，谁让之前没有写过vue的导出数据呢，不折腾的攻城狮跟病猫有什么区别，不多说了，上思路与代码。  好在折腾了两天发现了js-xlsx这个东东，一个功能很强大excel处理库，只是下载各种格式excel，还支持读取excel，于是我就借鉴官网的例子搞了一下，其实原理我也不太懂，只是在">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-11-05T02:30:09.213Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vue-xlsx excel文件导出折腾小记">
<meta name="twitter:description" content="# 前沿 最近再写vue-element-ui-pc项目中需要把数据导出为excel的需求，于是乎就开始折腾呗，没办法，谁让之前没有写过vue的导出数据呢，不折腾的攻城狮跟病猫有什么区别，不多说了，上思路与代码。  好在折腾了两天发现了js-xlsx这个东东，一个功能很强大excel处理库，只是下载各种格式excel，还支持读取excel，于是我就借鉴官网的例子搞了一下，其实原理我也不太懂，只是在">
  
    <link rel="alternate" href="/atom.xml" title="郝峰的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">郝峰的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">越努力,越幸运</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.haofengvip.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-vueXlsx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/11/vueXlsx/" class="article-date">
  <time datetime="2017-12-11T03:23:18.000Z" itemprop="datePublished">2017-12-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Vue-xlsx excel文件导出折腾小记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前沿"><a href="#前沿" class="headerlink" title="# 前沿"></a># 前沿</h1><hr>
<p>最近再写vue-element-ui-pc项目中需要把数据导出为excel的需求，于是乎就开始折腾呗，没办法，谁让之前没有写过vue的导出数据呢，不折腾的攻城狮跟病猫有什么区别，不多说了，上思路与代码。</p>
<blockquote>
<p>好在折腾了两天发现了js-xlsx这个东东，一个功能很强大excel处理库，只是下载各种格式excel，还支持读取excel，于是我就借鉴官网的例子搞了一下，其实原理我也不太懂，只是在使用造好的轮子而已。</p>
</blockquote>
<blockquote>
<p>写在开始，在本插件中需要注意到的几个地方  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以下为需要用到的插件库</span><br><span class="line">npm install file-saver@1.3.3     用来保存文件的</span><br><span class="line">npm install --save-dev script-loader   由于由于这几个文件不支持import引入，所以我们需要`script-loader`来将他们挂载到全局环境下。</span><br><span class="line">npm install xlsx   //就是上边提到的js-xlsx这个东东</span><br><span class="line">npm install jszip  //导出为压缩文件////或者是将文件压缩</span><br></pre></td></tr></table></figure>
<h1 id="Step-一"><a href="#Step-一" class="headerlink" title="# # Step 一"></a># # Step 一</h1><p>首先，先创建一个公共文件夹，里边存放封装的公共的导出的js,这里起名为vendor,里边放三个封装好的文件，分别为 </p>
<h1 id="1，Blog-js"><a href="#1，Blog-js" class="headerlink" title="# # # # 1，Blog.js"></a># # # # 1，Blog.js</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">//Blog.js官网写好的，直接用就好了，主要是用来转二进制用的。</span><br><span class="line">/* eslint-disable */</span><br><span class="line">(function(view) &#123;</span><br><span class="line">    &quot;use strict&quot;;</span><br><span class="line"></span><br><span class="line">    view.URL = view.URL || view.webkitURL;</span><br><span class="line"></span><br><span class="line">    if (view.Blob &amp;&amp; view.URL) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            new Blob;</span><br><span class="line">            return;</span><br><span class="line">        &#125; catch (e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Internally we use a BlobBuilder implementation to base Blob off of</span><br><span class="line">    // in order to support older browsers that only have BlobBuilder</span><br><span class="line">    var BlobBuilder = view.BlobBuilder || view.WebKitBlobBuilder || view.MozBlobBuilder || (function(view) &#123;</span><br><span class="line">        var</span><br><span class="line">            get_class = function(object) &#123;</span><br><span class="line">                return Object.prototype.toString.call(object).match(/^\[object\s(.*)\]$/)[1];</span><br><span class="line">            &#125;,</span><br><span class="line">            FakeBlobBuilder = function BlobBuilder() &#123;</span><br><span class="line">                this.data = [];</span><br><span class="line">            &#125;,</span><br><span class="line">            FakeBlob = function Blob(data, type, encoding) &#123;</span><br><span class="line">                this.data = data;</span><br><span class="line">                this.size = data.length;</span><br><span class="line">                this.type = type;</span><br><span class="line">                this.encoding = encoding;</span><br><span class="line">            &#125;,</span><br><span class="line">            FBB_proto = FakeBlobBuilder.prototype,</span><br><span class="line">            FB_proto = FakeBlob.prototype,</span><br><span class="line">            FileReaderSync = view.FileReaderSync,</span><br><span class="line">            FileException = function(type) &#123;</span><br><span class="line">                this.code = this[this.name = type];</span><br><span class="line">            &#125;,</span><br><span class="line">            file_ex_codes = (</span><br><span class="line">                &quot;NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR &quot; +</span><br><span class="line">                &quot;NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR&quot;</span><br><span class="line">            ).split(&quot; &quot;),</span><br><span class="line">            file_ex_code = file_ex_codes.length,</span><br><span class="line">            real_URL = view.URL || view.webkitURL || view,</span><br><span class="line">            real_create_object_URL = real_URL.createObjectURL,</span><br><span class="line">            real_revoke_object_URL = real_URL.revokeObjectURL,</span><br><span class="line">            URL = real_URL,</span><br><span class="line">            btoa = view.btoa,</span><br><span class="line">            atob = view.atob</span><br><span class="line"></span><br><span class="line">        , ArrayBuffer = view.ArrayBuffer, Uint8Array = view.Uint8Array;</span><br><span class="line">        FakeBlob.fake = FB_proto.fake = true;</span><br><span class="line">        while (file_ex_code--) &#123;</span><br><span class="line">            FileException.prototype[file_ex_codes[file_ex_code]] = file_ex_code + 1;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!real_URL.createObjectURL) &#123;</span><br><span class="line">            URL = view.URL = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        URL.createObjectURL = function(blob) &#123;</span><br><span class="line">            var</span><br><span class="line">                type = blob.type,</span><br><span class="line">                data_URI_header;</span><br><span class="line">            if (type === null) &#123;</span><br><span class="line">                type = &quot;application/octet-stream&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">            if (blob instanceof FakeBlob) &#123;</span><br><span class="line">                data_URI_header = &quot;data:&quot; + type;</span><br><span class="line">                if (blob.encoding === &quot;base64&quot;) &#123;</span><br><span class="line">                    return data_URI_header + &quot;;base64,&quot; + blob.data;</span><br><span class="line">                &#125; else if (blob.encoding === &quot;URI&quot;) &#123;</span><br><span class="line">                    return data_URI_header + &quot;,&quot; + decodeURIComponent(blob.data);</span><br><span class="line">                &#125;</span><br><span class="line">                if (btoa) &#123;</span><br><span class="line">                    return data_URI_header + &quot;;base64,&quot; + btoa(blob.data);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    return data_URI_header + &quot;,&quot; + encodeURIComponent(blob.data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if (real_create_object_URL) &#123;</span><br><span class="line">                return real_create_object_URL.call(real_URL, blob);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        URL.revokeObjectURL = function(object_URL) &#123;</span><br><span class="line">            if (object_URL.substring(0, 5) !== &quot;data:&quot; &amp;&amp; real_revoke_object_URL) &#123;</span><br><span class="line">                real_revoke_object_URL.call(real_URL, object_URL);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        FBB_proto.append = function(data /*, endings*/ ) &#123;</span><br><span class="line">            var bb = this.data;</span><br><span class="line">            // decode data to a binary string</span><br><span class="line">            if (Uint8Array &amp;&amp; (data instanceof ArrayBuffer || data instanceof Uint8Array)) &#123;</span><br><span class="line">                var</span><br><span class="line">                    str = &quot;&quot;,</span><br><span class="line">                    buf = new Uint8Array(data),</span><br><span class="line">                    i = 0,</span><br><span class="line">                    buf_len = buf.length;</span><br><span class="line">                for (; i &lt; buf_len; i++) &#123;</span><br><span class="line">                    str += String.fromCharCode(buf[i]);</span><br><span class="line">                &#125;</span><br><span class="line">                bb.push(str);</span><br><span class="line">            &#125; else if (get_class(data) === &quot;Blob&quot; || get_class(data) === &quot;File&quot;) &#123;</span><br><span class="line">                if (FileReaderSync) &#123;</span><br><span class="line">                    var fr = new FileReaderSync;</span><br><span class="line">                    bb.push(fr.readAsBinaryString(data));</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // async FileReader won&apos;t work as BlobBuilder is sync</span><br><span class="line">                    throw new FileException(&quot;NOT_READABLE_ERR&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if (data instanceof FakeBlob) &#123;</span><br><span class="line">                if (data.encoding === &quot;base64&quot; &amp;&amp; atob) &#123;</span><br><span class="line">                    bb.push(atob(data.data));</span><br><span class="line">                &#125; else if (data.encoding === &quot;URI&quot;) &#123;</span><br><span class="line">                    bb.push(decodeURIComponent(data.data));</span><br><span class="line">                &#125; else if (data.encoding === &quot;raw&quot;) &#123;</span><br><span class="line">                    bb.push(data.data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                if (typeof data !== &quot;string&quot;) &#123;</span><br><span class="line">                    data += &quot;&quot;; // convert unsupported types to strings</span><br><span class="line">                &#125;</span><br><span class="line">                // decode UTF-16 to binary string</span><br><span class="line">                bb.push(unescape(encodeURIComponent(data)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        FBB_proto.getBlob = function(type) &#123;</span><br><span class="line">            if (!arguments.length) &#123;</span><br><span class="line">                type = null;</span><br><span class="line">            &#125;</span><br><span class="line">            return new FakeBlob(this.data.join(&quot;&quot;), type, &quot;raw&quot;);</span><br><span class="line">        &#125;;</span><br><span class="line">        FBB_proto.toString = function() &#123;</span><br><span class="line">            return &quot;[object BlobBuilder]&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">        FB_proto.slice = function(start, end, type) &#123;</span><br><span class="line">            var args = arguments.length;</span><br><span class="line">            if (args &lt; 3) &#123;</span><br><span class="line">                type = null;</span><br><span class="line">            &#125;</span><br><span class="line">            return new FakeBlob(</span><br><span class="line">                this.data.slice(start, args &gt; 1 ? end : this.data.length), type, this.encoding</span><br><span class="line">            );</span><br><span class="line">        &#125;;</span><br><span class="line">        FB_proto.toString = function() &#123;</span><br><span class="line">            return &quot;[object Blob]&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">        FB_proto.close = function() &#123;</span><br><span class="line">            this.size = this.data.length = 0;</span><br><span class="line">        &#125;;</span><br><span class="line">        return FakeBlobBuilder;</span><br><span class="line">    &#125;(view));</span><br><span class="line"></span><br><span class="line">    view.Blob = function Blob(blobParts, options) &#123;</span><br><span class="line">        var type = options ? (options.type || &quot;&quot;) : &quot;&quot;;</span><br><span class="line">        var builder = new BlobBuilder();</span><br><span class="line">        if (blobParts) &#123;</span><br><span class="line">            for (var i = 0, len = blobParts.length; i &lt; len; i++) &#123;</span><br><span class="line">                builder.append(blobParts[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return builder.getBlob(type);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;(typeof self !== &quot;undefined&quot; &amp;&amp; self || typeof window !== &quot;undefined&quot; &amp;&amp; window || this.content || this));</span><br></pre></td></tr></table></figure>
<p>#####2，Export2Excel.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">//主要是处理好数据并且暴露了两个接口export_table_to_excel和export_json_to_excel,我们常用export_json_to_excel因为更加的可控一点，我们可以自由的洗数据。</span><br><span class="line">/* eslint-disable */</span><br><span class="line">require(&apos;script-loader!file-saver&apos;);</span><br><span class="line">require(&apos;script-loader!@/vendor/Blob&apos;);</span><br><span class="line">import XLSX from &apos;xlsx&apos;</span><br><span class="line"></span><br><span class="line">function generateArray(table) &#123;</span><br><span class="line">    var out = [];</span><br><span class="line">    var rows = table.querySelectorAll(&apos;tr&apos;);</span><br><span class="line">    var ranges = [];</span><br><span class="line">    for (var R = 0; R &lt; rows.length; ++R) &#123;</span><br><span class="line">        var outRow = [];</span><br><span class="line">        var row = rows[R];</span><br><span class="line">        var columns = row.querySelectorAll(&apos;td&apos;);</span><br><span class="line">        for (var C = 0; C &lt; columns.length; ++C) &#123;</span><br><span class="line">            var cell = columns[C];</span><br><span class="line">            var colspan = cell.getAttribute(&apos;colspan&apos;);</span><br><span class="line">            var rowspan = cell.getAttribute(&apos;rowspan&apos;);</span><br><span class="line">            var cellValue = cell.innerText;</span><br><span class="line">            if (cellValue !== &quot;&quot; &amp;&amp; cellValue == +cellValue) cellValue = +cellValue;</span><br><span class="line"></span><br><span class="line">            //Skip ranges</span><br><span class="line">            ranges.forEach(function(range) &#123;</span><br><span class="line">                if (R &gt;= range.s.r &amp;&amp; R &lt;= range.e.r &amp;&amp; outRow.length &gt;= range.s.c &amp;&amp; outRow.length &lt;= range.e.c) &#123;</span><br><span class="line">                    for (var i = 0; i &lt;= range.e.c - range.s.c; ++i) outRow.push(null);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            //Handle Row Span</span><br><span class="line">            if (rowspan || colspan) &#123;</span><br><span class="line">                rowspan = rowspan || 1;</span><br><span class="line">                colspan = colspan || 1;</span><br><span class="line">                ranges.push(&#123; s: &#123; r: R, c: outRow.length &#125;, e: &#123; r: R + rowspan - 1, c: outRow.length + colspan - 1 &#125; &#125;);</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            //Handle Value</span><br><span class="line">            outRow.push(cellValue !== &quot;&quot; ? cellValue : null);</span><br><span class="line"></span><br><span class="line">            //Handle Colspan</span><br><span class="line">            if (colspan)</span><br><span class="line">                for (var k = 0; k &lt; colspan - 1; ++k) outRow.push(null);</span><br><span class="line">        &#125;</span><br><span class="line">        out.push(outRow);</span><br><span class="line">    &#125;</span><br><span class="line">    return [out, ranges];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function datenum(v, date1904) &#123;</span><br><span class="line">    if (date1904) v += 1462;</span><br><span class="line">    var epoch = Date.parse(v);</span><br><span class="line">    return (epoch - new Date(Date.UTC(1899, 11, 30))) / (24 * 60 * 60 * 1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function sheet_from_array_of_arrays(data, opts) &#123;</span><br><span class="line">    var ws = &#123;&#125;;</span><br><span class="line">    var range = &#123; s: &#123; c: 10000000, r: 10000000 &#125;, e: &#123; c: 0, r: 0 &#125; &#125;;</span><br><span class="line">    for (var R = 0; R != data.length; ++R) &#123;</span><br><span class="line">        for (var C = 0; C != data[R].length; ++C) &#123;</span><br><span class="line">            if (range.s.r &gt; R) range.s.r = R;</span><br><span class="line">            if (range.s.c &gt; C) range.s.c = C;</span><br><span class="line">            if (range.e.r &lt; R) range.e.r = R;</span><br><span class="line">            if (range.e.c &lt; C) range.e.c = C;</span><br><span class="line">            var cell = &#123; v: data[R][C] &#125;;</span><br><span class="line">            if (cell.v == null) continue;</span><br><span class="line">            var cell_ref = XLSX.utils.encode_cell(&#123; c: C, r: R &#125;);</span><br><span class="line"></span><br><span class="line">            if (typeof cell.v === &apos;number&apos;) cell.t = &apos;n&apos;;</span><br><span class="line">            else if (typeof cell.v === &apos;boolean&apos;) cell.t = &apos;b&apos;;</span><br><span class="line">            else if (cell.v instanceof Date) &#123;</span><br><span class="line">                cell.t = &apos;n&apos;;</span><br><span class="line">                cell.z = XLSX.SSF._table[14];</span><br><span class="line">                cell.v = datenum(cell.v);</span><br><span class="line">            &#125; else cell.t = &apos;s&apos;;</span><br><span class="line"></span><br><span class="line">            ws[cell_ref] = cell;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (range.s.c &lt; 10000000) ws[&apos;!ref&apos;] = XLSX.utils.encode_range(range);</span><br><span class="line">    return ws;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Workbook() &#123;</span><br><span class="line">    if (!(this instanceof Workbook)) return new Workbook();</span><br><span class="line">    this.SheetNames = [];</span><br><span class="line">    this.Sheets = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function s2ab(s) &#123;</span><br><span class="line">    var buf = new ArrayBuffer(s.length);</span><br><span class="line">    var view = new Uint8Array(buf);</span><br><span class="line">    for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) &amp; 0xFF;</span><br><span class="line">    return buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function export_table_to_excel(id) &#123;</span><br><span class="line">    var theTable = document.getElementById(id);</span><br><span class="line">    var oo = generateArray(theTable);</span><br><span class="line">    var ranges = oo[1];</span><br><span class="line"></span><br><span class="line">    /* original data */</span><br><span class="line">    var data = oo[0];</span><br><span class="line">    var ws_name = &quot;SheetJS&quot;;</span><br><span class="line"></span><br><span class="line">    var wb = new Workbook(),</span><br><span class="line">        ws = sheet_from_array_of_arrays(data);</span><br><span class="line"></span><br><span class="line">    /* add ranges to worksheet */</span><br><span class="line">    // ws[&apos;!cols&apos;] = [&apos;apple&apos;, &apos;banan&apos;];</span><br><span class="line">    ws[&apos;!merges&apos;] = ranges;</span><br><span class="line"></span><br><span class="line">    /* add worksheet to workbook */</span><br><span class="line">    wb.SheetNames.push(ws_name);</span><br><span class="line">    wb.Sheets[ws_name] = ws;</span><br><span class="line"></span><br><span class="line">    var wbout = XLSX.write(wb, &#123; bookType: &apos;xlsx&apos;, bookSST: false, type: &apos;binary&apos; &#125;);</span><br><span class="line"></span><br><span class="line">    saveAs(new Blob([s2ab(wbout)], &#123; type: &quot;application/octet-stream&quot; &#125;), &quot;test.xlsx&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function export_json_to_excel(&#123; header, data, filename = &apos;excel-list&apos;, autoWidth = true &#125; = &#123;&#125;) &#123;</span><br><span class="line">    /* original data */</span><br><span class="line">    data = [...data]</span><br><span class="line">    data.unshift(header);</span><br><span class="line">    var ws_name = &quot;SheetJS&quot;;</span><br><span class="line">    var wb = new Workbook(),</span><br><span class="line">        ws = sheet_from_array_of_arrays(data);</span><br><span class="line"></span><br><span class="line">    if (autoWidth) &#123;</span><br><span class="line">        /*设置worksheet每列的最大宽度*/</span><br><span class="line">        const colWidth = data.map(row =&gt; row.map(val =&gt; &#123;</span><br><span class="line">                /*先判断是否为null/undefined*/</span><br><span class="line">                if (val == null) &#123;</span><br><span class="line">                    return &#123; &apos;wch&apos;: 10 &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">                /*再判断是否为中文*/</span><br><span class="line">                else if (val.toString().charCodeAt(0) &gt; 255) &#123;</span><br><span class="line">                    return &#123; &apos;wch&apos;: val.toString().length * 2 &#125;;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    return &#123; &apos;wch&apos;: val.toString().length &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;))</span><br><span class="line">            /*以第一行为初始值*/</span><br><span class="line">        let result = colWidth[0];</span><br><span class="line">        for (let i = 1; i &lt; colWidth.length; i++) &#123;</span><br><span class="line">            for (let j = 0; j &lt; colWidth[i].length; j++) &#123;</span><br><span class="line">                if (result[j][&apos;wch&apos;] &lt; colWidth[i][j][&apos;wch&apos;]) &#123;</span><br><span class="line">                    result[j][&apos;wch&apos;] = colWidth[i][j][&apos;wch&apos;];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ws[&apos;!cols&apos;] = result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* add worksheet to workbook */</span><br><span class="line">    wb.SheetNames.push(ws_name);</span><br><span class="line">    wb.Sheets[ws_name] = ws;</span><br><span class="line"></span><br><span class="line">    var wbout = XLSX.write(wb, &#123; bookType: &apos;xlsx&apos;, bookSST: false, type: &apos;binary&apos; &#125;);</span><br><span class="line">    saveAs(new Blob([s2ab(wbout)], &#123; type: &quot;application/octet-stream&quot; &#125;), filename + &quot;.xlsx&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>#####2，Export2Zip.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//暴漏出export_txt_to_zip这个接口，用来到处压缩文件的</span><br><span class="line">/* eslint-disable */</span><br><span class="line">require(&apos;script-loader!file-saver&apos;);</span><br><span class="line">import JSZip from &apos;jszip&apos;</span><br><span class="line"></span><br><span class="line">export function export_txt_to_zip(th, jsonData, txtName, zipName) &#123;</span><br><span class="line">  const zip = new JSZip()</span><br><span class="line">  const txt_name = txtName || &apos;file&apos;</span><br><span class="line">  const zip_name = zipName || &apos;file&apos;</span><br><span class="line">  const data = jsonData</span><br><span class="line">  let txtData = `$&#123;th&#125;\r\n`</span><br><span class="line">  data.forEach((row) =&gt; &#123;</span><br><span class="line">    let tempStr = &apos;&apos;</span><br><span class="line">    tempStr = row.toString()</span><br><span class="line">    txtData += `$&#123;tempStr&#125;\r\n`</span><br><span class="line">  &#125;)</span><br><span class="line">  zip.file(`$&#123;txt_name&#125;.txt`, txtData)</span><br><span class="line">  zip.generateAsync(&#123;type:&quot;blob&quot;&#125;).then((blob) =&gt; &#123;</span><br><span class="line">    saveAs(blob, `$&#123;zip_name&#125;.zip`)</span><br><span class="line">  &#125;, (err) =&gt; &#123;</span><br><span class="line">    alert(&apos;导出失败&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###接下来就是在页面中使用了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">  &lt;el-button type=&quot;warning&quot;</span><br><span class="line">                     style=&quot;width:100px;height:36px;&quot;</span><br><span class="line">                     ref=&quot;btn&quot;</span><br><span class="line">                     @click=&apos;ExportData&apos;&gt;导出数据&lt;/el-button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">           list: [</span><br><span class="line">        &#123;</span><br><span class="line">          author: &quot;Carol&quot;,</span><br><span class="line">          comment_disabled: true,</span><br><span class="line">          content_short: &quot;我是测试数据&quot;,</span><br><span class="line">          display_time: &quot;1974-06-19 10:01:57&quot;,</span><br><span class="line">          forecast: 71.85,</span><br><span class="line">          id: 1,</span><br><span class="line">          importance: 2,</span><br><span class="line">          pageviews: 1670,</span><br><span class="line">          reviewer: &quot;Ruth&quot;,</span><br><span class="line">          status: &quot;deleted&quot;,</span><br><span class="line">          timestamp: 1126391703464,</span><br><span class="line">          title: &quot;哦i啥v就开始对方能看出来市场v恐龙世界&quot;,</span><br><span class="line">          type: &quot;JP&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      listLoading: true,</span><br><span class="line">      downloadLoading: false,</span><br><span class="line">      filename: &quot;&quot;,</span><br><span class="line">      autoWidth: true</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ExportData() &#123;</span><br><span class="line">      console.log(&quot;导出数据&quot;);</span><br><span class="line">      import(&quot;@/vendor/Export2Excel&quot;).then(excel =&gt; &#123;</span><br><span class="line">  //表格的表头列表</span><br><span class="line">        const tHeader = [&quot;Id&quot;, &quot;Title&quot;, &quot;Author&quot;, &quot;Readings&quot;, &quot;Date&quot;];</span><br><span class="line">//与表头相对应的数据里边的字段</span><br><span class="line">        const filterVal = [</span><br><span class="line">          &quot;id&quot;,</span><br><span class="line">          &quot;title&quot;,</span><br><span class="line">          &quot;author&quot;,</span><br><span class="line">          &quot;pageviews&quot;,</span><br><span class="line">          &quot;display_time&quot;</span><br><span class="line">        ];</span><br><span class="line">        const list = this.list;</span><br><span class="line">        const data = this.formatJson(filterVal, list);</span><br><span class="line">   //这里还是使用export_json_to_excel方法比较好，方便操作数据</span><br><span class="line">        excel.export_json_to_excel(&#123;</span><br><span class="line">          header: tHeader,</span><br><span class="line">          data,</span><br><span class="line">          filename: this.filename,</span><br><span class="line">          autoWidth: this.autoWidth</span><br><span class="line">        &#125;);</span><br><span class="line">        this.downloadLoading = false;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">//洗数据</span><br><span class="line">    formatJson(filterVal, jsonData) &#123;</span><br><span class="line">      return jsonData.map(v =&gt;</span><br><span class="line">        filterVal.map(j =&gt; &#123;</span><br><span class="line">          // if (j === &quot;timestamp&quot;) &#123;</span><br><span class="line">            // return parseTime(v[j]);</span><br><span class="line">          // &#125; else &#123;</span><br><span class="line">            return v[j];</span><br><span class="line">          // &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>#结束语</p>
<hr>
<p>至此，vue的到处excel就搞好了，其他两个，本次没有写demo,后期更新时会更新。还是那句话遇到需求，要迎接需求，折腾几次就好了。将本次折腾的结果记录下来，方便自己总结也希望可以帮助到小伙伴们。<br>要用公共组件请看更新的<a href="https://www.jianshu.com/p/2eac19f58098" target="_blank" rel="noopener">vue-xlsx 导出数据公共组件</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.haofengvip.top/2017/12/11/vueXlsx/" data-id="cjo3owmqm00048gpcr3zij4pq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/">vue</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/07/10/vueRush/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          vue 强制刷新子组件
        
      </div>
    </a>
  
  
    <a href="/2017/11/11/vueSpaLink/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">vue spa 单页面应用跳转打开新的页面</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/vue/" style="font-size: 10px;">vue</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/07/11/hello-world/">深入浅出之递归遍历查询json树之子节点</a>
          </li>
        
          <li>
            <a href="/2018/07/10/vueRush/">vue 强制刷新子组件</a>
          </li>
        
          <li>
            <a href="/2017/12/11/vueXlsx/">Vue-xlsx excel文件导出折腾小记</a>
          </li>
        
          <li>
            <a href="/2017/11/11/vueSpaLink/">vue spa 单页面应用跳转打开新的页面</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 feng-hao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>